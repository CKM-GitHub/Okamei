@model Models.SmitumoriKanriModel

@{
    ViewBag.Title = "SmitumoriKanriList";
}

<style>
    .table th:nth-child(6) {
        text-align: left;
    }

    .table th {
        padding-top: 2px;
        padding-bottom: 2px;
        background-color: #ffff66;
        font-size: 14px;
        text-align: center;
        white-space: nowrap;
    }

    .table tbody td {
        padding-top: 2px;
        padding-bottom: 2px;
        font-size: 14px;
        vertical-align: middle;
    }

    #tblSmitumoriKanri .SagyouDate,
    #tblSmitumoriKanri .KaesiYoteiDate,
    #tblSmitumoriKanri .TantouSiten,
    #tblSmitumoriKanri .TantouEigyou {
        min-width: 100px;
        max-width: 100px;
    }

    #tblSmitumoriKanri .TantouCad {
        min-width: 150px;
    }

    #tblSmitumoriKanri .BukkenName,
    #tblSmitumoriKanri .KoumutenName {
        min-width: 200px;
    }

    #tblSmitumoriKanri .KakoutuboSuu {
        min-width: 80px;
        text-align: right;
    }

    #tblSmitumoriKanri .SMitumoriCounter {
        display: none;
    }

    #tblSmitumoriKanri .delete-td {
        text-align: center;
        min-width: 50px;
        white-space: nowrap;
    }

    .btnAdd {
        min-width: 120px;
        position: relative;
        padding-right: 15px;
        padding-left: 15px;
    }
    button.btnAdd {
        margin-top: 5px;
    }
</style>

<h4>S見積管理表</h4>
<div id="main" class="main-content">
    <table class='table table-bordered' id="tblSmitumoriKanri">
        <thead>
            <tr>
                <th>作業日</th>
                <th>担当</th>
                <th>物件名</th>
                <th>工務店</th>
                <th>坪数</th>
                <th>支店</th>
                <th>営業</th>
                <th>返し予定日</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @{
                var columns = ViewBag.Data.Columns;
            }

            @foreach (System.Data.DataRow row in ViewBag.Data.Rows)
            {
            <tr>
                @{
                    var count = row.ItemArray.Count();
                    var items = row.ItemArray;
                    var SMitumoriCounter = row["SMitumoriCounter"].ToString();
                }
                @for (var i = 0; i < count; i++)
                {
                    if (@columns[i].Caption != "SMitumoriCounter")
                    {
                        if (@columns[i].Caption == "TantouCad")
                        {
                            <td class="@columns[i].Caption">
                                @Html.DropDownListFor(
                                model => model.TantouCad,
                                new SelectList(Model.TantouCadDropDownListItems, "DisplayText", "DisplayText", @items[i]),
                                "",
                                new { @class = "form-control" })
                            </td>
                        }
                        else if (@columns[i].Caption == "KoumutenName")
                        {
                            <td class="@columns[i].Caption">
                                @Html.DropDownListFor(
                                model => model.KoumutenName,
                                new SelectList(Model.KoumutenDropDownListItems, "DisplayText", "DisplayText", @items[i]),
                                "",
                                new { @class = "form-control size20" })
                            </td>
                        }
                        else if (@columns[i].Caption == "TantouSiten")
                        {
                            <td class="@columns[i].Caption">
                                @Html.DropDownListFor(
                                model => model.TantouSiten,
                                new SelectList(Model.TantouSitenDropDownListItems, "DisplayText", "DisplayText", @items[i]),
                                "",
                                new { @class = "form-control size20" })
                            </td>
                        }
                        else if (@columns[i].Caption == "TantouEigyou")
                        {
                            <td class="@columns[i].Caption">
                                @Html.DropDownListFor(
                                model => model.TantouEigyou,
                                new SelectList(Model.TantouEigyouDropDownListItems, "DisplayText", "DisplayText", @items[i]),
                                "",
                                new { @class = "form-control size20" })
                            </td>
                        }
                        else
                        {
                            if (SMitumoriCounter != "")
                            {
                                <td class="@columns[i].Caption">
                                    @items[i]
                                </td>
                            }
                            else
                            {
                                <td class="@columns[i].Caption">
                                    @{
                                        if (@columns[i].Caption == "SagyouDate" || @columns[i].Caption == "KaesiYoteiDate")
                                        {
                                            <input type="text" id="@columns[i].Caption" name="@columns[i].Caption" class="form-control" maxlength=10 />
                                        }
                                        else if (@columns[i].Caption == "BukkenName")
                                        {
                                            <input type="text" id="@columns[i].Caption" name="@columns[i].Caption" class="form-control" maxlength=30 />
                                        }
                                        else if (@columns[i].Caption == "KakoutuboSuu")
                                        {
                                            <input type="text" id="@columns[i].Caption" name="@columns[i].Caption" class="form-control" maxlength=6 />
                                        }
                                    }
                                </td>
                            }
                        }
                    }
                }
                <td class="delete-td">
                    <button type="button" class="btn btn-link delete-link" onclick="DeleteData('@SMitumoriCounter')">削除</button>
                </td>
            </tr>
            }
        </tbody>
    </table>
    <div class="form-group row" style="margin-top: 20px;">
        <div class="btnAdd">
            <button type="button" id="btnAdd" class="btn btn-secondary btnAdd">行追加</button>
        </div>
        <div class="footer-btn mx-auto">
            <button type="button" id="btnReturn" class="btn btn-secondary">戻る</button>
            <button type="button" id="btnProcess" class="btn btn-secondary">登録</button>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">

        $(document).ready(function () {

            $('#btnReturn').click(function () {
                showConfirmMessage("Q004", function () {
                    location.href = '@Url.Action("SetCondition", "SmitumoriKanri")';
                })
            });

            //check user id who has access or not to edit
            var model = {
                UserID: $('#user-id').text()
            }
            var user_role = calltoApiController('@Url.Action("UserIDCheck", "api/SmitumoriKanriApi")', model);
            if (!user_role) {
                $('#tblSmitumoriKanri tr td:nth-child(2) select').attr("disabled", true);
                $('#tblSmitumoriKanri tr td:nth-child(4) select').attr("disabled", true);
                $('#tblSmitumoriKanri tr td:nth-child(6) select').attr("disabled", true);
                $('#tblSmitumoriKanri tr td:nth-child(7) select').attr("disabled", true);
                $('#tblSmitumoriKanri tr th:last-child').attr("style", "display: none;");
                $('#tblSmitumoriKanri tr td:last-child').attr("style", "display: none;");
                $('#btnAdd').attr("style", "display: none;");
                $('#btnProcess').attr("style", "display: none;");
            }

            var t = bindDataTables($('#tblSmitumoriKanri'));
        });

        function DeleteData(SMitumoriCounter) {
            showConfirmMessage("Q003", function () {
                var model = {
                    SMitumoriCounter: SMitumoriCounter
                }
                var result = calltoApiController('@Url.Action("DeleteSMitumoriCounterData", "api/SmitumoriKanriApi")', model);
                if (!result)
                    return false;
                else
                    showMessage('I102', setTimeout(function () { window.location.reload(); }, 2000));
                return true;
            });
        }
    </script>
}
