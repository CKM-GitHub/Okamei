@model Models.HanyouMasterMaintenanceModel

@{
    ViewBag.Title = "HanyouMasterMaintenanceCondition";
    var serverDate = ViewBag.ServerDate;
}

<style type="text/css">
    .detail_wrap {
        display: -webkit-box;
        display: -webkit-flex;
        display: -moz-box;
        display: -ms-flexbox;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .detail_left1,
    .detail_right1 {
        width: 49%;
    }
</style>

<h4 class="page-title">汎用マスタメンテ</h4>
<div id="main" class="main-content">
    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title pk require">ID</label>
        </div>
        <div class="col-sm-10 form-inline">
            <input type="text" class="form-control size3" maxlength="3" id="ID" name="ID" />&nbsp;&nbsp;
            <span id="IDName">
            </span>
        </div>
    </div>

    <div class="row" style="margin: 20px;">
        @*add for null space*@
    </div>

    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title pk require">キー</label>
        </div>
        <div class="col-sm-10">
            <input type="text" class="form-control size10" maxlength="10" id="Key" name="Key" />
        </div>
    </div>

    <div class="row" style="margin: 20px;">
        @*add for null space*@
    </div>

    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title">文字型項目1</label>
        </div>
        <div class="col-sm-10">
            <input type="text" class="form-control size100" maxlength="100" id="Char1" name="Char1" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title">文字型項目2</label>
        </div>
        <div class="col-sm-10 form-inline">
            <input type="text" class="form-control size100" maxlength="100" id="Char2" name="Char2" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title">文字型項目3</label>
        </div>
        <div class="col-sm-10">
            <input type="text" class="form-control size100" maxlength="100" id="Char3" name="Char3" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title">文字型項目4</label>
        </div>
        <div class="col-sm-10">
            <input type="text" class="form-control size100" maxlength="100" id="Char4" name="Char4" />
        </div>
    </div>
    <div class="form-group row">
        <div class="col-sm-2">
            <label class="col-form-label label-title">文字型項目5</label>
        </div>
        <div class="col-sm-10">
            <input type="text" class="form-control size100" maxlength="100" id="Char5" name="Char5" />
        </div>
    </div>

    <div class="row" style="margin: 20px;">
        @*add for null space*@
    </div>

    <div class="detail_wrap">
        <div class="detail_left1">
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">数字型項目1</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size13" maxlength="10" id="Num1" name="Num1" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">数字型項目2</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size13" maxlength="10" id="Num2" name="Num2" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">数字型項目3</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size13" maxlength="10" id="Num3" name="Num3" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">数字型項目4</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size13" maxlength="10" id="Num4" name="Num4" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">数字型項目5</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size13" maxlength="10" id="Num5" name="Num5" />
                </div>
            </div>
        </div>

        <div class="detail_right1">
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">日付型項目1</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size10" maxlength="10" id="Date1" name="Date1" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">日付型項目2</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size10" maxlength="10" id="Date2" name="Date2" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">日付型項目3</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size10" maxlength="10" id="Date3" name="Date3" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">日付型項目4</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size10" maxlength="10" id="Date4" name="Date4" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-4">
                    <label class="col-form-label label-title">日付型項目5</label>
                </div>
                <div class="col-sm-8">
                    <input type="text" class="form-control size10" maxlength="10" id="Date5" name="Date5" />
                </div>
            </div>
        </div>
    </div>
    <div class="form-group row">
        <div class="main-content-footer mx-auto">
            <button type="button" id="btnReturn" class="btn btn-secondary" nofocus tabindex="18">戻る</button>
            <button type="button" id="btnProcess" class="btn btn-primary active" tabindex="19">登録</button>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">

        $(document).ready(function () {
            var Mode = '@Model.Mode';
            $('#btnReturn').click(function () {
                showConfirmMessage("Q003", function () {
                    if (Mode == "New") {
                        window.location.reload();
                    }
                    else
                        location.href = '@Url.Action("DisplayResult","HanyouKensaku")?ID=' + $("#ID").val();
                });
            });

            $('#btnProcess').click(function () {
                if (checkErrorOnSave()) {
                    if (Mode == "Delete")
                        showConfirmMessage("Q102", btnProcess);
                    else
                        showConfirmMessage("Q101", btnProcess);
                }
            });

            //date
            setDateTypeValidate('#Date1');
            setDateTypeValidate('#Date2');
            setDateTypeValidate('#Date3');
            setDateTypeValidate('#Date4');
            setDateTypeValidate('#Date5');

            //number
            setNumericValidate('#ID', 3, 0);
            setNumericValidate('#Num1', 10, 0);
            setNumericValidate('#Num2', 10, 0);
            setNumericValidate('#Num3', 10, 0);
            setNumericValidate('#Num4', 10, 0);
            setNumericValidate('#Num5', 10, 0);

            //is double-byte
            setDoubleByteValidate('#Key');
            setDoubleByteValidate('#Char1');
            setDoubleByteValidate('#Char2');
            setDoubleByteValidate('#Char3');
            setDoubleByteValidate('#Char4');
            setDoubleByteValidate('#Char5');

            if (Mode == "New") {
                $("#ID").focus();

                $('#ID').keydown(function (e) {
                    if (e.keyCode == 13 || e.keyCode == 9) {
                        var model = {
                            ID_val: $('#ID').val().trim(),
                            Key: 'ID_Check'
                        }
                        var result = calltoApiController('@Url.Action("CheckModifiedData", "api/HanyouMasterMaintenanceApi")', model);
                        if (!result) {
                            return false;
                        }
                        if (result.MessageID) {
                            showMessage(result);
                            return false;
                        }

                        if ($('#user-id').text() !== 'Admin' && $('#ID').val().trim() == 20) {
                            showMessage('E141');
                            return false;
                        }
                        else
                            $('#IDName').html(result[0].IDName);
                    }
                });

                $('#Key').keydown(function (e) {
                    if (e.keyCode == 13 || e.keyCode == 9) {
                        var model = {
                            ID_val: $('#ID').val().trim(),
                            Key: $('#Key').val().trim()
                        }
                        var result = calltoApiController('@Url.Action("CheckModifiedData", "api/HanyouMasterMaintenanceApi")', model);
                        if (!result) {
                            return false;
                        }
                        if (result.MessageID) {
                            showMessage(result);
                            return false;
                        }
                    }
                });
            }
            else if (Mode == "Edit") {
                var model = {
                    ID_val: '@Model.ID_val',
                    Key: '@Model.Key'
                }
                var result = calltoApiController('@Url.Action("GetDataResult", "api/HanyouMasterMaintenanceApi")', model);
                BindData(result);

                $("#ID").attr('disabled', 'disabled');
                $("#Key").attr('disabled', 'disabled');
                $("#Char1").focus();
            }
            else if (Mode == "Delete") {
                var model = {
                    ID_val: '@Model.ID_val',
                    Key: '@Model.Key'
                }
                var result = calltoApiController('@Url.Action("GetDataResult", "api/HanyouMasterMaintenanceApi")', model);
                BindData(result);

                $("#ID").attr('disabled', 'disabled');
                $("#Key").attr('disabled', 'disabled');
                $("#Char1").attr('disabled', 'disabled');
                $("#Char2").attr('disabled', 'disabled');
                $("#Char3").attr('disabled', 'disabled');
                $("#Char4").attr('disabled', 'disabled');
                $("#Char5").attr('disabled', 'disabled');
                $("#Num1").attr('disabled', 'disabled');
                $("#Num2").attr('disabled', 'disabled');
                $("#Num3").attr('disabled', 'disabled');
                $("#Num4").attr('disabled', 'disabled');
                $("#Num5").attr('disabled', 'disabled');
                $("#Date1").attr('disabled', 'disabled');
                $("#Date2").attr('disabled', 'disabled');
                $("#Date3").attr('disabled', 'disabled');
                $("#Date4").attr('disabled', 'disabled');
                $("#Date5").attr('disabled', 'disabled');
                $("#btnReturn").focus();
            }
        });

        function BindData(result) {
            $('#ID').val(result[0].ID);
            $('#Key').val(result[0].Key);
            $('#IDName').html(result[0].IDName);
            $('#Char1').val(result[0].Char1);
            $('#Char2').val(result[0].Char2);
            $('#Char3').val(result[0].Char3);
            $('#Char4').val(result[0].Char4);
            $('#Char5').val(result[0].Char5);
            $('#Num1').val(result[0].Num1);
            $('#Num2').val(result[0].Num2);
            $('#Num3').val(result[0].Num3);
            $('#Num4').val(result[0].Num4);
            $('#Num5').val(result[0].Num5);
            $('#Date1').val(result[0].Date1);
            $('#Date2').val(result[0].Date2);
            $('#Date3').val(result[0].Date3);
            $('#Date4').val(result[0].Date4);
            $('#Date5').val(result[0].Date5);
        }

        function btnProcess() {
            var Mode = '@Model.Mode';
            if (Mode == "New" || Mode == "Edit") {
                if (!$('#ID').val() || !$('#Key').val())
                    showMessage('E102');

                var model = GetUIData(Mode);
                var result = calltoApiController('@Url.Action("ModifyData", "api/HanyouMasterMaintenanceApi")', model);
                if (!result) {
                    return false;
                }
                else
                    showMessage('I101', btn_finalProcess(Mode));
            }
            else if (Mode == "Delete") {
                var model = GetUIData(Mode);
                var result = calltoApiController('@Url.Action("ModifyData", "api/HanyouMasterMaintenanceApi")', model);
                if (!result) {
                    return false;
                }
                else
                    showMessage('I102', btn_finalProcess(Mode));
            }

            return true;
        }

        function GetUIData(Mode) {
            obj =
            {
                ID_val: $('#ID').val(),
                Key: $('#Key').val(),
                ID_name: $('#IDName').text(),
                Char1: $('#Char1').val(),
                Char2: $('#Char2').val(),
                Char3: $('#Char3').val(),
                Char4: $('#Char4').val(),
                Char5: $('#Char5').val(),
                Num1: $('#Num1').val().replace(/,/g, ""),
                Num2: $('#Num2').val().replace(/,/g, ""),
                Num3: $('#Num3').val().replace(/,/g, ""),
                Num4: $('#Num4').val().replace(/,/g, ""),
                Num5: $('#Num5').val().replace(/,/g, ""),
                Date1: $('#Date1').val(),
                Date2: $('#Date2').val(),
                Date3: $('#Date3').val(),
                Date4: $('#Date4').val(),
                Date5: $('#Date5').val(),
                Mode: Mode,
                UserID: $('#user-id').text()
            };
            return obj;
        }

        function btn_finalProcess(Mode) {
            if (Mode == "New")
                setTimeout(function () { window.location.reload() }, 2000);
            else if (Mode == "Edit")
                setTimeout(function () { location.href = '@Url.Action("DisplayResult","HanyouKensaku")?ID=' + $("#ID").val() }, 2000);
            else if (Mode == "Delete")
                setTimeout(function () { location.href = '@Url.Action("DisplayResult","HanyouKensaku")?ID=' + $("#ID").val() }, 2000);
        }
    </script>
}
